<div class="dashboard-container">
  <h2>
    ğŸ“Š Dashboard de SatisfacciÃ³n, RecomendaciÃ³n y Facilidad de Compra
    <button mat-raised-button color="warn" (click)="reiniciarEstadisticas()">
      Actualizar EstadÃ­sticas
    </button>
    <button mat-raised-button color="primary" (click)="generarReportePDF()" style="margin-left: 1rem;">
      Descargar Reporte PDF
    </button>
  </h2>

  <div *ngIf="loading" class="loading-spinner">
    <mat-spinner color="primary"></mat-spinner>
    <p style="margin-top: 1rem; color: #4b5563;">Cargando estadÃ­sticas...</p>
  </div>

  <div *ngIf="!loading" class="charts-container">
    <!-- GrÃ¡fico de Pregunta 1 -->
    <div class="chart-card">
      <h4>ğŸ˜Š SatisfacciÃ³n con el Servicio Taquilla/Paqueteria</h4>
      <p class="most-voted">MÃ¡s votado: {{ getMostVotedResponse(stats.satisfaccion.pregunta1) }}</p>
      <canvas baseChart
        [data]="pregunta1Data"
        [options]="barChartOptions"
        [type]="barChartType">
      </canvas>
      <div class="stats-summary">
        <p>Total respuestas: {{ getTotalResponses(pregunta1Data) }}</p>
        <p>CSAT: {{ getAverageForChart(pregunta1Data) | number:'1.1-1' }}/5</p>
      </div>
    </div>

    <!-- GrÃ¡fico de Pregunta 2 -->
    <div class="chart-card">
      <h4>ğŸ¤ Servicio que ofrece la empresa</h4>
      <p class="most-voted">MÃ¡s votado: {{ getMostVotedResponse(stats.satisfaccion.pregunta2) }}</p>
      <canvas baseChart
        [data]="pregunta2Data"
        [options]="barChartOptions"
        [type]="barChartType">
      </canvas>
      <div class="stats-summary">
        <p>Total respuestas: {{ getTotalResponses(pregunta2Data) }}</p>
        <p>CSAT: {{ getAverageForChart(pregunta2Data) | number:'1.1-1' }}/5</p>
      </div>
    </div>

    <!-- GrÃ¡fico de RecomendaciÃ³n -->
    <div class="chart-card">
      <h4>ğŸ’¬ Â¿RecomendarÃ­an nuestro servicio?</h4>
      <p class="most-voted">MÃ¡s votado: {{ getMostVotedResponse(stats.recomendacion.respuestas) }}</p>
      <canvas baseChart
        [data]="recomendacionData"
        [options]="barChartOptions"
        [type]="barChartType">
      </canvas>
      <div class="stats-summary">
        <p>Total respuestas: {{ getTotalResponses(recomendacionData) }}</p>
        <p>NPS: {{ calculateNPS(stats.recomendacion.respuestas) | number:'1.0-0' }}%</p>
      </div>
    </div>

    <!-- GrÃ¡fico para Facilidad de Compra -->
    <div class="chart-card">
      <h4>ğŸ« Facilidad de Compra Boletos</h4>
      <p class="most-voted">MÃ¡s votado: {{ getMostVotedResponse(stats.facilidadCompra.facilidad) }}</p>
      <canvas baseChart
        [data]="facilidadData"
        [options]="barChartOptions"
        [type]="barChartType">
      </canvas>
      <div class="stats-summary">
        <p>Total respuestas: {{ getTotalResponses(facilidadData) }}</p>
        <p>CES: {{ getAverageForFacilityChart(facilidadData) | number:'1.1-1' }}/5</p>
      </div>
    </div>

    <!-- GrÃ¡fico para Plataformas de Compra -->
    <div class="chart-card">
      <h4>ğŸ–¥ï¸ Plataformas Utilizadas</h4>
      <p class="most-voted">MÃ¡s usada: {{ getMostVotedResponse(stats.facilidadCompra.plataforma) }}</p>
      <canvas baseChart
        [data]="plataformaData"
        [options]="barChartOptions"
        [type]="barChartType">
      </canvas>
      <div class="stats-summary">
        <p>Total respuestas: {{ getTotalResponses(plataformaData) }}</p>
        <p>Plataformas distintas: {{ stats.facilidadCompra.plataforma.length }}</p>
      </div>
    </div>

    <!-- GrÃ¡fico de Tendencias -->
    <div class="chart-card full-width">
      <h4>ğŸ“ˆ EvoluciÃ³n Mensual</h4>
      <canvas baseChart
        [data]="tendenciasData"
        [options]="lineChartOptions"
        [type]="lineChartType">
      </canvas>
    </div>

    <!-- GrÃ¡fico de CombinaciÃ³n Facilidad/Plataforma -->
    <div class="chart-card full-width">
      <h4>ğŸ“Š Facilidad por Plataforma</h4>
      <canvas baseChart
        [data]="combinacionData"
        [options]="comboChartOptions"
        [type]="barChartType">
      </canvas>
    </div>
  </div>
</div>
